<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>World Map Social â€“ FA/EN</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
 body { margin:0; font-family:sans-serif; background:#f5f5f5; direction:rtl; }
 .ltr { direction:ltr; text-align:left; }
 .center { display:flex; justify-content:center; align-items:center; height:100vh; }
 .card { background:white; padding:30px; border-radius:18px; box-shadow:0 5px 25px rgba(0,0,0,0.1); width:330px; }
 input, button, select { width:100%; padding:12px; border-radius:10px; margin-top:10px; border:1px solid #ddd; font-size:15px; }
 button { background:#111; color:white; cursor:pointer; }
 header { padding:15px 20px; font-size:20px; font-weight:bold; background:white; box-shadow:0 2px 10px rgba(0,0,0,0.05); display:flex; justify-content:space-between; align-items:center; }
 #map { height:300px; border-radius:15px; margin-top:20px; }
 .section { background:white; padding:20px; border-radius:15px; margin:20px; box-shadow:0 2px 10px rgba(0,0,0,0.05); }
</style>
</head>
<body>
<div id="auth" class="center">
  <div class="card" id="authCard">
    <h2 id="authTitle" style="text-align:center;">ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h2>
    <input id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" />
    <input id="password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" />
    <button onclick="login()" id="loginBtn">ÙˆØ±ÙˆØ¯</button>
    <button onclick="signup()" style="background:#555;" id="signupBtn">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
    <select id="langAuth" onchange="setLang(this.value)">
      <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
      <option value="en">English</option>
    </select>
  </div>
</div>

<div id="app" style="display:none;">
  <header>
    <span id="headerTitle">ğŸŒ Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ù†Ù‚Ø´Ù‡</span>
    <select id="langMain" onchange="setLang(this.value)">
      <option value="fa">FA</option>
      <option value="en">EN</option>
    </select>
  </header>

  <div class="section">
    <h3 id="mapTitle">Ù†Ù‚Ø´Ù‡ Ø¬Ù‡Ø§Ù†</h3>
    <div id="map"></div>
    <p id="countryInfo"></p>
  </div>

  <div class="section">
    <h3 id="uploadTitle">Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª</h3>
    <input type="file" id="imgUpload" />
    <button onclick="postImage()" id="postBtn">Ø§Ø±Ø³Ø§Ù„</button>
  </div>

  <div class="section">
    <h3 id="feedTitle">Ù¾Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
    <div id="feed"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let lang = localStorage.lang || 'fa';
const texts = {
  fa:{authTitle:'ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…',login:'ÙˆØ±ÙˆØ¯',signup:'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…',user:'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ',pass:'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±',header:'ğŸŒ Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ù†Ù‚Ø´Ù‡',map:'Ù†Ù‚Ø´Ù‡ Ø¬Ù‡Ø§Ù†',postTitle:'Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª',post:'Ø§Ø±Ø³Ø§Ù„',feed:'Ù¾Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†',country:'Ú©Ø´ÙˆØ±'},
  en:{authTitle:'Login / Signup',login:'Login',signup:'Signup',user:'Username',pass:'Password',header:'ğŸŒ World Map Social',map:'World Map',postTitle:'Upload Post',post:'Upload',feed:'User Posts',country:'Country'}
};

function setLang(l){ lang=l; localStorage.lang=l; applyLang(); }
function applyLang(){
  document.body.style.direction = lang==='fa'?'rtl':'ltr';
  document.getElementById('authTitle').innerText=texts[lang].authTitle;
  username.placeholder=texts[lang].user;
  password.placeholder=texts[lang].pass;
  loginBtn.innerText=texts[lang].login;
  signupBtn.innerText=texts[lang].signup;
  headerTitle.innerText=texts[lang].header;
  mapTitle.innerText=texts[lang].map;
  uploadTitle.innerText=texts[lang].postTitle;
  postBtn.innerText=texts[lang].post;
  feedTitle.innerText=texts[lang].feed;
}

applyLang();

function login(){
  if(username.value && password.value){
    localStorage.user = username.value;
    startApp();
  } else {
    alert(lang === "fa" ? "Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯" : "Please fill all fields");
  }
}}
function signup(){
  if(username.value && password.value){
    localStorage.user = username.value;
    alert(lang === "fa" ? "Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!" : "Signup successful!");
    startApp();
  } else {
    alert(lang === "fa" ? "Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯" : "Please fill all fields");
  }
}

function startApp(){ document.getElementById('auth').style.display='none'; document.getElementById('app').style.display='block'; initMap(); loadFeed(); }
if(localStorage.user) startApp();

let map;
function initMap(){
 map=L.map('map').setView([20,10],2);
 L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18}).addTo(map);
 map.on('click',async e=>{
   const data = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${e.latlng.lat}&lon=${e.latlng.lng}&format=json`).then(r=>r.json());
   countryInfo.innerHTML = data.address.country ? `${texts[lang].country}: ${data.address.country}` : 'Not found';
 });
}

function postImage(){ let f=imgUpload.files[0]; if(!f) return alert('Select image'); let r=new FileReader(); r.onload=()=>{let p=JSON.parse(localStorage.posts||'[]'); p.push({user:localStorage.user,img:r.result}); localStorage.posts=JSON.stringify(p); loadFeed();}; r.readAsDataURL(f);} 

function loadFeed(){ feed.innerHTML=''; let p=JSON.parse(localStorage.posts||'[]'); p.forEach(x=>{ let d=document.createElement('div'); d.innerHTML=`<b>${x.user}</b><br><img src='${x.img}' style='width:100%;border-radius:12px;margin-top:10px'>`; feed.appendChild(d); }); }
</script>
</body>
</html>
